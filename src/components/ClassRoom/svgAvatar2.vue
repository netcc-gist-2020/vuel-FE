<template>
  <div class="wrap">
    <svg viewBox="0 0 83 105" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M30 71.6079C12.8 73.2079 2.33333 94.8333 0 103.5C27.5 106 83.7 104.708 82.5 95.1079C81.3 85.5079 67.6667 76.4412 61 73.1079C57.8333 71.9412 47.2 70.0079 30 71.6079Z" fill="#8C5DB0"/>
      <path id="neck" d="M41.0584 78.5C34.6584 81.3 33.7251 75.3333 34.0584 72V62H48.0585C48.3918 66.3333 47.4584 75.7 41.0584 78.5Z" fill="#EFD7C5"/>

      <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="34" y="62" width="15" height="18">
      <path d="M41.0584 78.5C34.6584 81.3 33.7251 75.3333 34.0584 72V62H48.0585C48.3918 66.3333 47.4584 75.7 41.0584 78.5Z" fill="#EFD7C5"/>
      </mask>
      <g mask="url(#mask0)">
      <path d="M40.5 70.747C47.3004 71.7222 48.2921 69.644 47.9379 68.483V65H33.0621C32.7079 66.5093 33.6997 69.7717 40.5 70.747Z" fill="#E7C5AC"/>
      </g>

      <path id="face_left" d="M13.154 60.47C10.5177 57.0673 10.6326 51.3541 11.7417 49.1275C12.3209 47.9646 12.8657 46.4668 13.5 44.5C12.1014 38.5333 11.1243 29.7216 11 25C11 11.1929 24.6553 0 41.5 0C58.3447 0 72 11.1929 72 25C71.8973 28.9012 70.9979 37.5674 70 43C69.3779 46.3869 67.5 50.5 65.5 54C63.5174 57.4696 57.4061 61.8878 55.0523 63.3056C52.3443 64.9367 44.2247 68.9768 31.514 68.9768C18.8033 68.9768 16.4494 64.7234 13.154 60.47Z" fill="#6E6BFF"/>
      <path id="face_right" d="M69.846 60.47C72.4823 57.0673 72.3674 51.3541 71.2583 49.1275C70.6791 47.9646 70.1343 46.4668 69.5 44.5C70.8986 38.5333 71.8757 29.7216 72 25C72 11.1929 58.3447 0 41.5 0C24.6553 0 11 11.1929 11 25C11.1027 28.9012 12.0021 37.5674 13 43C13.6221 46.3869 15.5 50.5 17.5 54C19.4826 57.4696 25.5939 61.8878 27.9477 63.3056C30.6557 64.9367 38.7753 68.9768 51.486 68.9768C64.1967 68.9768 66.5506 64.7234 69.846 60.47Z" fill="#6BFF71"/>
      <path id="face" d="M41.5 0C24.6553 0 11 11.1929 11 25C11.1667 31.3333 12.6713 43.9545 15 49C18 55.5 24 69 41.5 69C59 69 65 55.5 68 49C70.3287 43.9545 71.8333 31.3333 72 25C72 11.1929 58.3447 0 41.5 0Z" fill="#EFD7C5"/>
      <mask id="mask1" mask-type="alpha" maskUnits="userSpaceOnUse" x="11" y="0" width="61" height="69">
      <path d="M41.5 0C24.6553 0 11 11.1929 11 25C11.1667 31.3333 12.6713 43.9545 15 49C18 55.5 24 69 41.5 69C59 69 65 55.5 68 49C70.3287 43.9545 71.8333 31.3333 72 25C72 11.1929 58.3447 0 41.5 0Z" fill="#EFD7C5"/>
      </mask>
      <g mask="url(#mask1)">
      <path d="M32.3077 25.6902C26.8009 30.3841 16.011 31.8937 10.5912 32.0363H9.59119C9.92453 34.5363 10.5912 40.8363 10.5912 46.0363C10.5912 52.5363 3.59119 53.0363 8.59119 65.0363C13.5912 77.0363 20.5 79 20.5 82.5C20.5 85.3 18.4246 84.5363 14.5912 87.0363C5.42457 89.8697 -11.2088 94.0363 -4.40877 88.0363C4.09123 80.5363 -0.408767 70.0363 -0.408767 55.0363C-0.408767 40.0363 2.09123 18.0363 16.0912 2.03633C27.2912 -10.7637 35.4246 -7.96367 38.0912 -4.96367C40.7579 -7.96367 49.4912 -12.7637 63.0912 -7.96367C80.0912 -1.96367 85.5912 23.0363 87.0912 32.0363L71.5 36.1826C65.9 32.9826 51.7579 18.0363 50.5912 12.0363C50.5912 13.0363 49.6912 16.6363 46.0912 23.0363C42.4912 29.4363 32.5912 31.703 28.0912 32.0363C29.3505 30.12 30.9155 27.7577 32.3077 25.6902Z" fill="#728E97"/>
      </g>

      <path id="saliva" d="M46 55.8204C47.3091 55.5016 47.5545 55.4938 48.2733 55C49.2619 56.1773 49.4843 56.6834 50.2941 57.6975C51.3044 58.9628 51.2389 60.6451 50.0415 61.6741C49.767 62.0217 49.0311 62.0912 48.2733 61.8827C46.9976 61.5316 47.7681 60.6313 48.0207 58.5318C48.2441 56.6754 46.6736 55.9595 46 55.8204Z" fill="white"/>
      <rect x="46" y="45" width="7" height="16" fill="#EFD7C5"/>
      <path id="nose_left" class="nose2" d="M30.9448 44C31.2781 44.8333 31.3448 47.1 28.9448 49.5C26.5448 51.9 29.2781 53.1667 30.9448 53.5" stroke="black"/>
      <path id="nose_right" class="nose2" d="M51.1691 44C50.8358 44.8333 50.7691 47.1 53.1691 49.5C55.5691 51.9 52.8358 53.1667 51.1691 53.5" stroke="black"/>
      <path id="norm_right" class="eye" d="M52 39C52 40.6569 51.1046 42 50 42C48.8954 42 48 40.6569 48 39C48 37.3431 48.8954 36 50 36C51.1046 36 52 37.3431 52 39Z" fill="black"/>
      <path id="norm_left" class="eye" d="M30,39a2,3 0 1,0 4,0a2,3 0 1,0 -4,0" fill="black"/>
      <path id="nose_center" class="nose" d="M40.8768 44C41.2102 44.8333 41.5214 46.325 40.3216 49.5C39.3768 52 40.6549 53.1667 42.3216 53.5" stroke="black"/>
      <path id="happy_right" class="happy" d="M54.2453 42L55 41.5944C51.9811 37.2675 48.8113 39.1605 47 41.4591L47.7547 42C51.2566 38.1058 53.0377 40.3774 54.2453 42Z" fill="black"/>
      <path id="happy_left" class="happy" d="M27.7547 42L27 41.5944C30.0189 37.2675 33.1887 39.1605 35 41.4591L34.2453 42C30.7434 38.1058 28.9623 40.3774 27.7547 42Z" fill="black"/>
      <path id="mouth_center" d="M32.878 57.46L32 57.92C41.2195 67.1203 46.3415 61.7535 50 57.92L49.561 57C42.9756 65.7403 36.3902 61.1401 32.878 57.46Z" fill="#DB6B6B"/>
      <path id="mouth_happy" class="happy" d="M47.0737 57.5614C42.2664 58.3159 40.6389 58.3128 35.5526 57.5523C34.551 57.4026 33.9781 58.6648 34.7618 59.3063C40.7821 64.2341 42.175 64.2312 47.8924 59.2976C48.6519 58.6422 48.0647 57.4059 47.0737 57.5614Z" fill="#DB6B6B"/>

      <path id="mouth_sleepy" class="sleepy" d="M49.2521 59.1398C42.0521 55.9398 38.7521 57.1398 36.2521 57.6398C35.3682 57.8166 32.2633 58.967 32.0307 60.467C31.688 62.6767 34.2521 62.1398 37.7521 62.1398C40.2521 62.1398 58.2521 63.1398 49.2521 59.1398Z" fill="#DB6B6B"/>
      <path id="sleepy_right" class="sleepy" d="M54.2453 40L55 40.4056C51.9811 44.7325 48.8113 42.8395 47 40.5409L47.7547 40C51.2566 43.8942 53.0377 41.6226 54.2453 40Z" fill="black"/>
      <path id="sleepy_left" class="sleepy" d="M27.7547 40L27 40.4056C30.0189 44.7325 33.1887 42.8395 35 40.5409L34.2453 40C30.7434 43.8942 28.9623 41.6226 27.7547 40Z" fill="black"/>
  </svg>
<div id="info">
    {{ userId }}
    {{ expression }}
</div>
</div>
</template>

<script>
import gsap from 'gsap'
import router from '@/router'

export default {
  name: 'SvgAvatar2',
  props: {
    userId: String,
    index: Number,
    absence: String,
    expression: String,
    eyeDir: String
  },
  data: () => ({

  }),
  methods: {
    getExpression (index, expression, eyeDir) {
      if (this.eyeDir === 'right') this.lookLeft()
      else if (this.eyeDir === 'right') this.lookRight()
      else this.lookCenter()

      if (this.expression === 'happy') this.happy()
      else if (this.expression === 'sleepy') this.sleepy()
      else this.normal()
    },
    rmSaliva () {
      const at = 0.3
      gsap.to('#saliva', { opacity: 0, duration: 0.1 })
      gsap.to('#saliva', { duration: at, y: -5 })
    },
    normal () {
      const at = 0.3
      this.rmSaliva()
      gsap.to('#norm_right', { duration: at, morphSVG: '#norm_right' })
      gsap.to('#norm_left', { duration: at, morphSVG: '#norm_left' })
      gsap.to('#mouth_center', { duration: at, morphSVG: '#mouth_center' })
    },
    lookLeft () {
      const at = 0.3
      this.normal()
      gsap.to('#face', { duration: at, morphSVG: '#face_left' })
      gsap.to('#nose_center', { duration: at, morphSVG: '#nose_left' })
      gsap.to('.eye', { duration: at, x: -10 })
      gsap.to('#mouth_center', { duration: at, x: -10 })
    },
    lookCenter () {
      const at = 0.3
      this.normal()
      this.rmSaliva()
      gsap.to('#face', { duration: at, morphSVG: '#face' })
      gsap.to('#nose_center', { duration: at, morphSVG: '#nose_center' })
      gsap.to('.eye', { duration: at, x: 0 })
      gsap.to('#mouth_center', { duration: at, x: 0 })
    },
    lookRight () {
      const at = 0.3
      this.normal()
      gsap.to('#face', { duration: at, morphSVG: '#face_right' })
      gsap.to('#nose_center', { duration: at, morphSVG: '#nose_right' })
      gsap.to('.eye', { duration: at, x: 10 })
      gsap.to('#mouth_center', { duration: at, x: 10 })
    },
    sleepy () {
      const at = 0.3
      this.lookCenter()
      gsap.to('#norm_right', { duration: at, morphSVG: '#sleepy_right' })
      gsap.to('#norm_left', { duration: at, morphSVG: '#sleepy_left' })
      gsap.to('#mouth_center', { duration: at, morphSVG: '#mouth_sleepy' })
      gsap.to('#saliva', { opacity: 100, duration: at })
      gsap.to('#saliva', { duration: at, delay: at, y: 5 })
    },
    happy () {
      const at = 0.3
      this.lookCenter()
      gsap.to('#norm_right', { duration: at, morphSVG: '#happy_right' })
      gsap.to('#norm_left', { duration: at, morphSVG: '#happy_left' })
      gsap.to('#mouth_center', { duration: at, morphSVG: '#mouth_happy' })
    },
    leave () {
      router.push('mypage')
    }
  },
  watch: {
    expression (exp) {
      console.log('Expression for svg avatar is: ' + exp)
      this.expression = exp
    }
  },
  mounted () {
    console.log('SvgAvatar2!')
  }
}
</script>

<style>
svg {
    margin: 10px auto;
    width: 100%;
}
#saliva {
    opacity: 0%;
}
.happy, .sleepy, #face_right, #face_left, .nose2, .mouth2 {
    visibility:hidden;
}

.wrap {
    display: inline-flex;
    position: absolute;
    top: 10%;
    left: 20%;
    margin-top: -20px;
    margin-left: 0px;
    text-align: center;
}
</style>
